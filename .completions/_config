#compdef config

# this can probably be done by monkey patching _call_program
# hooking it before and after this completion
# but i keep f'ing up monkey patching zsh functions
_config() {
    (
        # config add does nothing out of the box cause __git_other_files hangs
        # get it working for at least __git_modified_files
        _git-add() { __git_modified_files; }
        # _git-add() { __git_modified_files; 	__git_files --others --directory --exclude-standard --exclude '*/*'; }


        # delegate the completer to git
        # also replace git on the path to config, but only for the first time its run
        words[1]=git PATH="$HOME/.completions/.config-bin:$PATH" _normal
    )
}

# _original="${(kv)functions[_call_program]}"
# _config_call_program() {
#     set -- "$1" config "$@"
#     eval $_original "$@"
# }
# _call_program() { _config_call_program "$@"; }

# __override_call_program() { _call_program() { _config_call_program "$@"; }; }
# __override_call_program
# __override_call_program() { functions[_call_program]="set -- $1 config $@; $@"; }
